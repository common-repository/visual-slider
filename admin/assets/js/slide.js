(function ($, undefined) {
	  'use strict';
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			 Isset
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/  
	  
	function isset(variable){
		return  variable  !== "undefined" && variable  !== "0" && variable !== null && variable !== '';
	}
	
	function empty(variable){
		if(variable  === "undefined" && variable === null && variable === ''){
			return '';
		}else{
			return variable;
		}
	}
		
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			 Slide Json
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
	$.fn.vs_slide_json =  function() { 
  		var slide =  [];
 		$('.vs_module_slide_item').each(function(i) {
 			 $(this).attr('data-count',i+1);
			var key = $(this).attr('data-key');
 			var value = $(this).attr('data-value');
  			var option = $(this).find('.vs_module_slide_option').html();
 			var layer = $(this).find('.vs_module_slide_layer').html();
 
			var slide_key  = {};
			  slide_key[key] = {'value' : value,'option':option ,'layer':layer };
			 slide.push(slide_key); 
 		});
		$('#vs_slide').val( JSON.stringify(slide));
	};

		
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Sortable
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	

	$.fn.vs_sortable =  function() { 
 		
		$('.vs_module_slide_list').sortable({
			opacity: 0.6,
 			update: function() {
  				$('body').vs_slide_json();
				 $('body').vs_reload_global_slider();
 			}			
		});
 	};

  
	
	
	
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Start Document Ready
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
 
	jQuery(document).ready(function() {
		$('body').vs_sortable();
 /*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			ADD Slide
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
	  
	  
 	$('.vs_metabox').on('click', '.vs_module_slide_add', function() {
		 
		if(visualslider.is_rtl==='true'){
		var title_name= 'اسلاید جدید';
		}else{
		var title_name= 'New Slide';
		}
		$('.vs_module_slide_title').each(function() {
			var name = $(this).html();
			
			var substr = [1,2,3,4,5,6,7,8,9,10,11,12,13,13,14,15,16,17,18,20];
			$.each(substr , function(index) { 
				if(name === 'New Slide ('+index+')'){
					title_name = 'New Slide ('+(index + 1)+')';
				}
			});
			if(name === 'New Slide'){
					title_name = 'New Slide (2)';
			}		 
		});
		
		
		
		$('body').append('<div class="vs-mouse-wait"></div>');
  		var data_key = 'r'+Math.floor(Math.random() * 9999999999);
		
  		$.ajax({
			type: 'POST',
  			url: visualslider.ajaxurl,
			data : {
				action : 'vs_module_slide_item',
				key : data_key,
				value :  'slide',
				default :  '1',
				default_title :  title_name,
	
 			},
			success:function(data) {
 				if(data.length){
					$('.vs_module_slide_list').append(data);
  					$('.vs-mouse-wait').remove();
					$('body').vs_slide_json();
				 $('body').vs_reload_global_slider();
    				} else{
					$('body').vs_remove_add_error_loading();
  				}
   			} 
		});
  	});	
	
	$('.vs_metabox').on('click', ".vs_module_slide_remove", function(e) {
		$(this).parents('.vs_module_slide_item').fadeOut("normal", function() {
		$(this).remove();
				$('body').vs_slide_json();
				 $('body').vs_reload_global_slider();

		});
 	});
	
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Slide Duplicate
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
	function vs_duplicate(row,key,adress) {	
		$(adress).attr('data-key',key).attr('id',"vs_"+row+"_"+ key);
 	}
		
	jQuery(document).on("click",".vs_module_slide_duplicate",function(){
   
   		var duplicate = $(this).parents(".vs_module_slide_item").addClass('vs_duplicate').clone();
		$(this).parents('.vs_duplicate').removeClass('vs_duplicate');
		$(this).parents(".vs_module_slide_item ").after(duplicate);
 		var slide_key = 'r'+Math.floor(Math.random() * 9999999999);
  		vs_duplicate('module_slide',slide_key,'.vs_duplicate');
 		$('.vs_duplicate').removeClass('vs_duplicate');
		
		$('body').vs_slide_json();
		$('body').vs_reload_global_slider();
 
 }); 		 
		
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Slide Optins
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
	 
	$('.vs_metabox').on('click', ".vs_module_slide_options", function(e) {
		
 		$('body').append('<div class="vs-mouse-wait"></div>');
		
  		var data_key = $(this).parents('.vs_module_slide_item').attr('data-key');
  		var data_count = $(this).parents('.vs_module_slide_item').attr('data-count');
  		var data_option = $(this).parents('.vs_module_slide_item').find('.vs_module_slide_option').html();
  		var data_layer = $(this).parents('.vs_module_slide_item').find('.vs_module_slide_layer').html();
 		var data_this = $(this);
		var data_setting_json = $('#vs_setting_json').val();
 
  		var data_tablet=  $('.vs_live_setting_responsive_tablet').find('input:checked').val();
  		var data_mobile=  $('.vs_live_setting_responsive_mobile').find('input:checked').val();
  

   		$.ajax({
			type: 'POST',
 			url: visualslider.ajaxurl,
			data : {
				action : 'vs_module_panel_options',
 				option :  data_option,
 				layer :  data_layer,
 				key :  data_key,
 				count :  data_count,
 				vs_setting_json :  data_setting_json,
 				vs_tablet :  empty(data_tablet),
 				vs_mobile :  empty(data_mobile),
				 
			},
			success:function(data) {
 				if( data.length){
					$('body').append(data);
   					$(".vs-mouse-wait").remove(); 
									
				 
 
						$('body').vs_fold_hide();
						 $('body').vs_sortable_layer();
						 $('body').vs_draggable();
						 $('body').vs_coloris();
 						$('body').vs_fold_item();
						$('body').find('.vs_module_layer_item').each(function() {
							$(this).vs_layer_options_perview();
						}); 
						
						$( ".vs_perview_slide .vs_perview_heading_desktop" ).trigger( "click" );
   	  
					//vs_add_hander('#vs_options_' +data_key);
  				}else{
					$('body').vs_remove_add_error_loading(); 	
				}
   			} 
		});	
  	});	
	
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																		 Slide Options Side
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************************************************************/
 
 	$(document).on('click', '.vs_module_slide_options_show', function() {
		$(this).addClass('vs_module_slide_options_active');
  		 $(this).parents('.vs_panel').find('.vs_module_side_options_active').removeClass('vs_module_side_options_active');
   		 $('#vs_module_slide_options').addClass('vs_module_side_options_active');
  		 $(this).parents('.vs_panel').addClass('vs_panel_options_active');
 		 
  		 $(this).parents('.vs_panel').find('.vs_draggable_active').removeClass('vs_draggable_active');
 		$('.vs_module_side_options_active').vs_fold_item();
  
 	
	
	});
 	
	
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Slide Save
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/		
 
function removeEmptyAndZero(obj) {
  for (var key in obj) {
    if (obj[key] === null || obj[key] === undefined || obj[key] === '') {
      delete obj[key];
    } else if ($.type(obj[key]) === 'object') {
      removeEmptyAndZero(obj[key]);
      var sum = Object.values(obj[key]).reduce(function(acc, val) {
        return acc + val;
      }, 0);
      if (sum === 0) {
        delete obj[key];
      }
    }
  }
  return obj;
}
 
	$(document).on('click', '.vs_panel_save', function() {
		var has_title ='';
		var data_key = $(this).parents('.vs_panel').attr('data-key');
		
	 
	 
			$('body').append('<div class="vs-mouse-wait"></div>');
			var data_slide_option = removeEmptyAndZero($(this).parents('.vs_panel').find('#vs_module_slide_options').serializeJSON());
			var data_layer =removeEmptyAndZero($('body').vs_layer_json());
  			var data_this = $(this);
	 
			
			$('#vs_module_slide_'+data_key).find('.vs_module_slide_inner').remove();
			 
			$.ajax({
				type: 'POST',
				url: visualslider.ajaxurl,
				data : {
					action : 'vs_module_slide_inner',
					option :   JSON.stringify(data_slide_option),
					layer :  JSON.stringify(data_layer),
				},
				success:function(data) {
						if( data.length){
						$('#vs_module_slide_'+data_key).append(data);
							$('.vs-mouse-wait').remove(); 
							$(data_this).parents('.vs_panel').remove();
							 $('body').vs_slide_json();
							 $('body').vs_sortable_layer();
						 $('body').vs_reload_global_slider();

						}else{
							$('body').vs_remove_add_error_loading(); 	
						}
					} 
					
			 }); 
		 
	});  
	$(document).on('click', '.vs_panel_cancel', function() {
		$(this).parents('.vs_panel').remove();
	});  
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Ready END 
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/		
});  
	
	
})(jQuery);

		